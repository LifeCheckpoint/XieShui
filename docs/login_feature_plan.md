# 登录功��实现计划

## 目标

实现一个简单的用户注册和登录功能，支持学生、教师和系统管理员三种角色，并将用户数据存储在 SQLite 数据库中。

## 计划步骤

### 1. 后端开发 (Flask)

*   **数据库设置：**
    *   安装必要的 Python 库，例如 `Flask-SQLAlchemy`。
    *   配置 Flask 应用以连接到 SQLite 数据库文件（例如 `users.db`）。
    *   定义一个用户模型 (User Model)，包含字段：用户ID/学号 (唯一标识符)、用户名、密码（直接存储，不进行哈希）、用户角色（学生、教师、管理员）。
    *   创建数据库和用户表（如果不存在）。
*   **注册接口 (`/register`):**
    *   创建一个 Flask 路由 `/register`，接受 POST 请求。
    *   从请求中获取用户提交的数据：用户ID/学号、用户名、密码、用户角色。
    *   根据用户角色进行输入验证：系统管理员必须提供密码，学生和教师密码可以为空。
    *   检查用户ID/学号或用户名是否已存在于数据库中。
    *   将新用户数据直接保存到数据库。
    *   返回注册成功或失败的 JSON 响应（包含 `status` 和 `message` 字段）。
*   **登录接口 (`/login`):**
    *   创建一个 Flask 路由 `/login`，接受 POST 请求。
    *   从请求中获取用户提交的登录凭据：用户ID/学号或用户名，以及密码。
    *   在数据库中查找匹配用户ID/学号或用户名的用户。
    *   如果找到用户：
        *   检查用户是否有设置密码。
        *   如果用户设置了密码，直接比较提供的密码与存储的密码是否匹配。
        *   如果用户未设置密码，则无需密码验证即可登录成功。
        *   如果登录成功，返回成功 JSON 响应（包含 `status` 和 `message`，以及用户角色等信息）。
        *   如果登录失败（用户未找到或密码不匹配），返回失败 JSON 响应。
    *   如未找到用户，返回失败 JSON 响应。
*   **错误处理：** 实现基本的错误处理机制，返回 JSON 格式的错误信息。

### 2. 前端开发 (HTML/CSS/JS)

*   **创建登录/注册页面：**
    *   在 `frontend/` 目录下创建一个新的 HTML 文件，例如 `login.html`。
    *   设计一个包含以下输入字段的表单：用户ID/学号、用户名、密码。
    *   添加一个用于选择用户角色的元素（例如下拉菜单或单选按钮），选项包括：学生、教师、系统管理员。
    *   添加“注册”和“登录”按钮。
    *   添加一个用于显示成功/失败消息的区域（例如一个 `div` 元素）。
*   **创建欢迎页面：**
    *   在 `frontend/` 目录下创建一个新的 HTML 文件，例如 `welcome.html`。这是一个简单的页面，用于在用户登录成功后跳转。
*   **样式设计：**
    *   创建相应的 CSS 文件（例如 `frontend/css/login.css` 和 `frontend/css/welcome.css`）来美化页面。
*   **JavaScript 逻辑：**
    *   创建一个 JavaScript 文件（例如 `frontend/js/login.js`）来处理前端逻辑。
    *   添加事件监听器到“注册”和“登录”按钮。
    *   当点击按钮时，从表单中获取用户输入的数据。
    *   使用 JavaScript 的 Fetch API 或 XMLHttpRequest 向后端相应的 `/register` 或 `/login` 接口发送 POST 请求。
    *   处理后端返回的 JSON 响应：
        *   根据 `status` 字段显示成功或失败消息在指定的区域。
        *   如果登录成功，使用 `window.location.href` 将页面重定向到 `welcome.html`。
    *   实现基本的客户端输入验证（例如，检查系统管理员密码是否为空）。
*   **页面链接：** 在项目的入口页面（例如 `index.html` 或修改现有的 `health_check.html`）添加链接或重定向到 `login.html` 页面。

## 系统架构图

```mermaid
graph TD
    A[用户浏览器] --> B{前端登录/注册页面};
    B --> C{用户输入信息};
    C --> D{选用户角色};
    D --> E{点击 注册/登录};
    E --> F{发送 HTTP 请求};
    F --> G[后端 Flask 应用];
    G --> H{处理 /register 或 /login 请求};
    H --> I[SQLite 数据库];
    I --> H;
    H --> J{验证用户 / 存储数据};
    J --> G;
    G --> K{返回 JSON 响应};
    K --> B;
    B --> L{显示消息 / 页面跳转};
    L --> M[前端欢迎页面];